### T1

直接按照题目模拟，设 $f_{i, j, k, 0/1}$ 表示从 $(1, 1)$ 走到 $(i, j)$，异或和为 $k$，且没有扔掉/扔掉一个珍珠的方案数。

每次直接枚举 $(i, j, k)$ 是向下走还是向右走就行。

时间复杂度 $O(nma)$。



### T2

考虑将一条合法的路径在 LCA 处计算进答案。可以设 $f_{i, j}$ 表示 $i$ 子树内一条祖先-儿子链，且祖先>儿子，最后一个点是 $j$ 的方案数，$g_{i, j}$ 则是祖先<儿子，最后一个点是 $j$ 的方案数。

当 $u$ 合并一颗子树 $v$ 的时候，答案会增加 $\sum\limits_{a < b} f_{u, a} \times g_{v, b} + f_{u, b} \times g_{v, a}$。

时间复杂度 $O(n^2)$。



### T3

分别要记 $f_{i, j}$ 表示所有数确定完低 $i$ 位，且低 $i$ 位的和等于 $n$ 的低 $i$ 位的方案数，$g_{i, j}$ 表示所有合法方案中的异或和。

转移的话，$f_{i, j}$ 直接枚举第 $i + 1$ 位有几个 $1$，设为 $x$，然后只要 $x + j$ 的奇偶性和 $n$ 第 $i + 1$ 位一样就行。

$g_{i, j}$ 有两个部分的贡献：一个是低于 $i + 1$ 位的贡献，一个是第 $i + 1$ 位的贡献。分别算即可。即 $g_{i, j} \times \binom{n}{x} + 2^{i + 1} \times f_{i, j} \times \binom{n}{x}$。

时间复杂度 $O(n^2 \log m)$。



### T4

首先，假设当我们已经选好了每个点的标准，那么每个人就一定会贪心地去他所能到达的店中标准最高的。

可以枚举这个区间的最大值是什么，即设 $f_{i, j}$ 表示只考虑区间 $[i, j]$ 里的人的最大收益是什么，然后枚举标准最高的点 $k$，设能到达 $k$ 的人有 $t$ 个，那么就是 $f_{i, k - 1} + f_{j, k + 1} + g_{k, t}$，其中 $g_{k, t}$ 表示有 $t$ 个人到第 $k$ 家店，合理选择标准能达到的最高收益是什么。

那么接下来就是求出所有 $g_{k, t}$。由于每个人都求这个（过程一样），于是下面用 $c_i$ 代表标准为 $i$ 的花费，$f_j$ 表示有 $j$ 个人来，那么最高收益是什么。



显然 $f_j = \max i \times j - c_i$。这个是一个标准的斜率优化式子，建出凸包来即可。

但是斜率优化是有限制的，比如这些都是能放在平面直角坐标系上面的直线（也就是说贡献都可以写成 $kx + b$）的形式。

下面给一种感觉通用性更高，且理解起来并不比斜率优化复杂的决策单调性优化方法（虽然写起来其实本质相同）。



对于一个 $j$，假设 $i_1 < i_2$，且这个时候选 $i_2$ 比 $i_1$ 更加优秀，那么对于所有 $k > j$，$i_2$ 都会比 $i_1$ 优秀，那么 $i_1$ 在这之后就没有用了。

那么我们按 $i$ 从小到大的顺序加入 $i \times j - c_i$ 这条直线。假设已经处理完了之前的所有直线，那么对于所有可能成为最优选择的 $i_1 < i_2 < \cdots i_k$，一定有 $i_x$ 是 $i_{x - 1}$ 后面一些点的最优解。

我们对每个 $i_x$ 记录 $p_x$ 表示对于 $j < p_x$，$i_x$ 比 $i_{x + 1}$ 优，之后则是 $i_{x + 1}$ 优，那么显然 $p_1 < p_2 < \cdots p_{k - 1}$。

否则若 $p_x > p_{x + 1}$，那么在 $i_{x + 1}$ 比 $i_x$ 优之前，$i_{x + 2}$ 就已经比 $i_{x + 1}$ 优了，所以 $i_{x + 1}$ 就不可能成为最优选择了。



那么加入 $i$ 的时候，先算出来 $i$ 比 $i_k$ 什么时候优（因为 $i > i_k$，所以一定有个时间更优），设为 $y$，那么如果 $x_{k - 1} > y$，那么根据上面 $p_x$ 单调的解释，就需要删除 $i_k$，那么这样做就能维护出对于所有 $j$，什么 $i$ 最优。

做完这个之后直接枚举 $j$，然后双指针不断从前往后扫到最后一个 $p_x < j$ 的 $x$，$i_{x + 1}$ 就是最优的答案。

这样的时间复杂度是线性。于是，整个题时间复杂度 $O(n^3 + nk)$。


